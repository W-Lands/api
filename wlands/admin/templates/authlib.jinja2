{% extends "layout.jinja2" %}
{% import "macros.jinja2" as macros %}

{% block title %}Authlib Agent{% endblock %}
{% block nav_authlib %}active{% endblock %}

{% block content %}
    <h1>Authlib Agent</h1>
    {% if agent %}
        <dl class="row">
            {{ macros.details_row("Id", agent.id) }}
            {{ macros.details_row("Created At", agent.created_at|format_datetime) }}
            {{ macros.details_row("Size", agent.size|format_size) }}
            {{ macros.details_row("Sha1", agent.sha1) }}
            {{ macros.details_row("Min Launcher Version", agent.min_launcher_version) }}
        </dl>
    {% else %}
        <h3>No authlib agent</h3>
    {% endif %}

    <div>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#upload-agent-modal">Upload new</button>
        {% if agent %}
            <a class="btn btn-primary ms-2" href="{{ agent.url() }}">Download current</a>
        {% endif %}
    </div>

    <div class="modal fade" id="upload-agent-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5">Update authlib agent</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="" method="POST" id="upload-agent-form" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="min-version-input" class="form-label fw-bold">Minimum launcher version</label>
                            <input type="number" class="form-control" id="min-version-input" name="min_launcher_version" required value="{% if agent %}{{ agent.min_launcher_version }}{% endif %}"/>
                        </div>
                        <div class="mb-3">
                            <label for="agent-file" class="form-label fw-bold">Agent JAR file</label>
                            <input type="file" class="form-control" id="agent-file" name="file" {% if not agent %}required{% endif %} accept=".jar">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" form="upload-agent-form">update</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
